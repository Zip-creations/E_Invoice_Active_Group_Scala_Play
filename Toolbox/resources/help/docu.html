<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
Design by TEMPLATED
http://templated.co
Released for free under the Creative Commons Attribution License

Name       : Justifiable 
Description: A two-column, fixed-width design with dark color scheme.
Version    : 1.0
Released   : 20130801

-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Dokumentation - OpenXRechnungToolbox</title>
<meta name="keywords" content="OpenXRechnungToolbox, XRechnung" />
<meta name="description" content="OpenXRechnungToolbox Hilfe" />
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800|Open+Sans+Condensed:300,700" rel="stylesheet" />
<link href="default.css" rel="stylesheet" type="text/css" media="all" />
<link href="fonts.css" rel="stylesheet" type="text/css" media="all" />

<!--[if IE 6]><link href="default_ie6.css" rel="stylesheet" type="text/css" /><![endif]-->

</head>
<body>

<button onclick="topFunction()" id="topBtn" title="Go to top">nach oben</button>
<script type="text/javascript" src="topbutton.js"> </script>


<div id="logo" class="container">
	<h1><span class="icon icon-o icon-size2"></span><span class="icon icon-x icon-size"></span><span class="icon icon-t icon-size2"></span><a href="index.html">Open<span>XRechnung</span>Toolbox</a></h1>
	<p>by <a href="author.html" rel="nofollow">Dr. Jan C. Thiele</a></p>
</div>
<div id="wrapper" class="container">
	<div id="menu" class="container">
		<ul>
			<li><a href="index.html" accesskey="1" title="">OXT</a></li>
			<li><a href="author.html" accesskey="1" title="">Autor</a></li>
			<li><a href="manual.html" accesskey="2" title="">Benutzerhandbuch</a></li>
			<li class="current_page_item"><a href="docu.html" accesskey="3" title="">Dokumentation</a></li>
			<li><a href="license.html" accesskey="4" title="">Lizenz</a></li>
			<li><a href="impress.html" accesskey="5" title="">Impressum</a></li>
		</ul>
	</div>
	<div id="three-column" class="container">
	<p> 
		<br/>
		<br/>
	</p>
	</div>
	<div id="page">
		<!--
		<div><span class="arrow-down"></span></div>
		-->
		<div><!-- id="box1">-->
			<div class="title">
				<h2>Dokumentation</h2>
			</div>
			<p>
			Im Folgenden finden Sie Hinweise für das Customizing und die Weiterentwicklung der OpenXRechnungToolbox. 
			OpenXRechnungToolbox ist eine Open Source Software, die sich selbst ausschließlich verschiedener Open Source Bibliotheken bedient.
			Daher haben Sie die Möglichkeit, den Quellcode der Software zu beziehen und diesen unter Einhaltung der Lizenzbedingungen selbständig weiterzuentwickeln.
			Da Open Source Projekte von der Mitarbeit vieler Leben, freue ich mich, wenn Sie Ihre Optimierungen und Weiterentwicklungen auch wieder frei und öffentlich verfügbar machen.
			</p>
			
			<h3>Inhalt</h3>
			<p>
			<div style="text-indent:15px;"><a href="#customizing">Customizing</a><br /></div>
				<div style="text-indent:30px;"><a href="#configuration">Konfigurationsdatei</a><br /></div>
					<div style="text-indent:45px;"><a href="#languages">Sprachen hinzufügen</a><br /></div>
					<div style="text-indent:45px;"><a href="#validationtool">Prüftoolkonfigurationsversionen hinzufügen</a><br /></div>
					<div style="text-indent:45px;"><a href="#visualization">Visualisierung konfigurieren</a><br /></div>
				<div style="text-indent:30px;"><a href="#help">Hilfedateien</a><br /></div>
				<div style="text-indent:30px;"><a href="#logging">Logging</a><br /></div>
			<div style="text-indent:15px;"><a href="#development">Entwicklung und Build</a><br /></div>
			</p>

			<h3><a id="customizing">Customizing</a></h3>
			<p>
			Die OpenXRechnungToolbox kann über zwei Mechanismen gecustomized werden, ohne, dass der Quellcode verändert werden muss. 
			Die Software nutzt dafür einnerseits eine Konfigurationsdatei und andererseits Sprachdateien.
			</p>
			<h4><a id="configuration">Konfigurationsdatei</a></h4>
			<p class="h4">
			Die Konfigurationsdatei finden Sie unter: <i>resources/app.config</i>. Es handelt sich hierbei um eine gewöhnliche Textdatei nach dem <i>key=value</i> Schema. 
			In dieser Konfigurationsdatei sind vor allem Speicherpfade verschiedener Grafiken/Icons für die Benutzeroberfläche sowie die verfügbaren Sprachen als auch 
			die Versionen des Prüftools mit den entsprechenden Speicherpfaden und die Konfiguration für die Visualisierungskomponente hinterlegt.
			</p>
			<h5><a id="languages">Sprachen hinzufügen</a></h5>
			<p class="h5">
			Sie können hier z.B. eine neue Sprachen registrieren.
			Dazu erweitern Sie die kommagetrennte Liste der Spachkürzel im Key <i>available_languages</i> um die entsprechende zusätzliche Sprache und legen die neuen Sprachdatei im Pfade
			<i>resources/languages</i> mit dem Datennamensschema: <i>AppWindow_<Sprachkürzel>.properties</i> ab. 
			Die aktuell gewählte Sprache ist im Key <i>language</i> festgelegt. Dieser Eintrag kann hier händisch direkt in der Datei geändert werden oder über die Benutzeroberfläche im Menü <i>Einstellungen</i>.
			</p>
			<h5><a id="validationtool">Prüftoolkonfigurationsversionen hinzufügen</a></h5>
			<p class="h5">
			Eine zusätzliche Version des Prüftools machen Sie wie folgt verfügbar:
			Im Pfad <i>resources/validatorxrechnung</i> legen Sie einen neuen Unterordner für die neuen Prüftoolkonfigurationendateien an und legen diese darin ab.
			Im Key <i>available_valiVersions</i> fügen Sie in der kommagetrennten Liste einen neuen Wert für die neue Konfiguration hinzu.
			Nun fügend Sie folgende neue Keys mit den entsprechenden Speicherpfaden hinzu (ggf. können die Pfade variieren, z.B. wenn neue Syntaxversionen genutzt werden): <br />
			<i>validator.scenario.<neuer Wert>=resources/validatorxrechnung/<neuer Wert>/scenarios.xml</i> <br />
			<i>validator.cii.xsd.<neuer Wert>=resources/validatorxrechnung/<neuer Wert>/resources/cii/16b/xsd/CrossIndustryInvoice_100pD16B.xsd</i> <br />
			<i>validator.ubl.xsd.<neuer Wert>=resources/validatorxrechnung/<neuer Wert>/resources/ubl/2.1/xsd/maindoc/UBL-Invoice-2.1.xsd</i> <br />
			<i>validator.ublcn.xsd.<neuer Wert>=resources/validatorxrechnung/<neuer Wert>/resources/ubl/2.1/xsd/maindoc/UBL-CreditNote-2.1.xsd</i> <br />
			Die jeweils genutzte Version der Prüftoolkonfiguration ist im Key <i>valiVersion</i> eingetragen. Sie kann hier händisch in der Datei geändert werden oder über die Benutzeroberfläche im Menü <i>Einstellungen</i>.
			</p>
			<p class="h5">
			Die mit der Software ausgelieferten Prüftoolkonfigurationen besitzen eine kleine Anpassung zur besseren Darstellung der Umbrüche im mitgelieferten Browser. 
			Hierzu wird in der Datei <i><Prüftoolversion>/resources/default-report.xsl</i> im Block:<br />
			<i>
			.metadata dt {<br />
                float: left;<br />
                width: 230px;<br />
                clear: left;<br />
            }<br />
			</i>
			die Breite auf 250px erhöht.
			</p>
			<h5><a id="visualization">Visualisierung konfigurieren</a></h5>
			<p class="h5">
			Die Einstellungen für die Visualisierung sind hier zu finden: <br />
			<i>viz.intermediate.ubl.xsl=resources/viewer/ubl-invoice-xr.xsl</i> <br />
			<i>viz.intermediate.ublcn.xsl=resources/viewer/ubl-creditnote-xr.xsl</i> <br />
			<i>viz.intermediate.cii.xsl=resources/viewer/cii-xr.xsl</i> <br />
			<i>viz.html.xsl=resources/viewer/xrechnung-html.xsl</i> <br />
			</p>
			<p class="h5">			
			Soll eine andere Version der Visualisierung genutzt werden, können entweder hier andere Speicherpfade angegeben werden oder unter den angegebenen Speicherpfaden die Dateien ausgetauscht werden.
			</p>
			<p class="h5">
			Die Einstellung, ob die Codelisten aufgelöst werden sollen findet sich im Key <i>viz.codelistresolve</i>.
			Dazu sind entsprechend eigene Speicherpfade für die adaptierte VIsualisierungskomponente registriert: <br />
			<i>viz.intermediate.ublcn.xsl.codelistresolve=resources/viewer/codelistresolve/ubl-creditnote-xr.xsl</i> <br />
			<i>viz.intermediate.ubl.xsl.codelistresolve=resources/viewer/codelistresolve/ubl-invoice-xr.xsl</i> <br />
			<i>viz.intermediate.cii.xsl.codelistresolve=resources/viewer/codelistresolve/cii-xr.xsl</i> <br />			
			Die HTML-Auflösung ist Codelisten-neutral. Daher gibt es keinen zusätzlichen Key für <i>viz.html</i>.
			</p>
			<p>
			Die Codelistenauflösung ist ein eigenständiges Projekt, ebenfalls von Dr. Jan C. Thiele. Dieses Projekt hat eine eigene Dokumentation, die hier 
			zu finden ist: <a href="https://github.com/jcthiele/xrechnung-visualization-codelist-resolve">Projekt Codelistenauflösung</a>.
			</p>
			<p>
			Ergänzend kann bei der Visualisierung die Ausgabesprache gewählt bzw. neue Sprachen hinzugefügt werden.
			Die Einstellung findet sich im Key <i>viz.language</i>.
			Soll eine weitere Sprache ergänzt werden, so ist eine entsprechende Sprachdatei im Ordner <i>resources/viewer/l10n</i> anzulegen, in den Dateien 
			<i>xr-content.xsl</i> und <i>xrechnung-html.xsl</i> Einträge für <i>decimal-format</i> vorzunehmen sowie im Key <i>available_vizLanguages</i> das Sprachkürzel zu ergänzen.
			</p>
			<h4><a id="help">Hilfedateien</a></h4>
			<p class="h4">
			Die vorliegenden Hilfedateien sind im Speicherpfade <i>resources/help</i> abgelegt. Dort können die HTML-Dateien angepasst werden, z.B. wenn Weiterentwicklungen der Toolbox vorgenommen wurden.
			</p>
			<h4><a id="logging">Logging</a></h4>
			<p class="h4">
			In der Datei <i>resources/log4j2.xml</i> können das Logging der Toolbox konfiguriert werden. Dieses basiert auf der Java-Bibliothek <a href="https://logging.apache.org/log4j/2.x/" target="_blank">log4j</a> mit den entsprechenden Konfigurationsmöglichkeiten.			
			</p>
			<h3><a id="development">Entwicklung und Build</a></h3>
			<p>
			Die OpenXRechnungToolbox wurde in Java in der Entwicklungsumgebung Eclipse als Maven-unterstütztes Projekt erstellt. Das Coderepository enthält zur vereinfachten Weiterentwicklung daher nicht nur die reinen Codequellen sondern das gesamte Eclipse-Projekt.
			Die Windows Executables werden im Maven-Build-Prozess über Launch4j automatisch erzeugt. <br />
			Der Windows-Installer wird mit NSIS (Nullsoft Scriptable Install System) über das Script <i>nsis_installer.nsi</i> im Nachgang erzeugt. <br />
			Für die Erzeugung der graphischen Benutzeroberfläche wird die SWT-Bibliothek verwendet. <br />
			</p>
			<p>
			Da die SWT-Bibliothek betriebssystemabhängig ist, muss die OpenXRechnungToolbox entsprechend betriebssystemspezifisch kompiliert werden. Dazu sind entsprechende Profile in der Maven-Spezifikationsdatei (pom.xml) spezifiert.
			Das Batch-Skript build-all-archs.bat führt entsprechend Maven-Aufrufe für alle Profile nacheinander aus, so dass hierüber alle zip-Archive zur Veröffentlichung erzeugt werden.
			</p>
			<p>
			Derzeit besteht das Projekt aus sechs Paketen: (1) <i>gui</i>, (2) <i>helpers</i>, (3) <i>leitwegcheck</i>, (4) <i>validation</i>, (5) <i>visualization</i>, (6) <i>cli</i>.
			Die Quellen für die Erzeugung der Benutzeroberflächen finden sich im Paket <i>gui</i>. Das Paket <i>helpers</i> enthält verschiedene ausgelagerte Hilfsfunktionen, z.B. für den Umgang mit der Konfigurationsdatei.
			Das Paket <i>cli</i> enthält die Methoden zur Nutzung der Toolbox im Kommandozeilen-Modus. Der Zugriff auf die Methoden aus der Kommandozeile heraus erfolgt aber über das Paket <i>gui</i>.
			Die weiteren drei Pakete enthalten die Backendfunktionen für die eigentlichen Tools: die Visualisierung (Paket <i>visualization</i>), die Prüfung (Paket <i>validation</i>) und die Leigweg-ID-Erzeugung/-Prüfung (Paket <i>leitwegcheck</i>).
			Eine automatischer Unittest ist derzeit noch nicht verfügbar. Ein Beitrag aus der Community wird sehr begrüßt.			
			</p>
			<p>
			Die Hauptklasse der OpenXRechnungsToolbox ist im Paket <i>gui</i> die Klasse <i>AppWindow.java</i>. Diese erzeugt das Hauptfenster und bietet Zugriff auf den Kommandozeilen-Modus. 
			Das Visualisierungs- sowie das Prüfergebnis wird in einem Browserfenster dargestellt, das von der Klasse <i>HTMLWindow.java</i> erzeugt wird. 
			Die Benutzeroberfläche der Leitweg-ID-Erzeugung und -Prüfung wird durch die Klasse <i>LWIDWindow.java</i> erzeugt. 
			Das Fenster für die Konfiguration der Einstellungen wird durch die Klasse <i>SettingsWindow.java</i> bereitgestellt.
			Alle weiteren Informationen können der <a href="./javadoc/index.html" target="_blank">javadoc Dokumentation</a> entnommen werden.
			</p>
			<p>
			Die einzelnen Schritte für die Erzeugung sind:
			<ul>
				<li>OpenJDK herunterladen</li>
				<li>JDK, NSIS, Maven & Eclipse installieren</li>
				<li>Eclipse Existing Maven Project importieren</li>
				<li><i>create_keystore.bat</i> ausführen</li>
				<li>keystore Passwort in Property <i>keystore.password</i> in <i>pom.xml</i> eintragen</li>
				<li><i>build_all_archs.bat</i> ausführen (mvn clean; mvn install)</li>
				<li>keystore Passwort in Zeile <i>finalize!</i> in <i>target/nsis_installer.nsi</i> eintragen</li>
				<li><i>nsis_installer.nsi</i> in Ordner target mit NSIS ausführen</li>
			</ul>
			</p>
		</div>		
	</div>

</div>
<div id="copyright">
	<p>&copy; Dr. Jan C. Thiele. </a> | Design by <a href="http://templated.co" rel="nofollow">TEMPLATED</a>.</p>
</div>
</body>
</html>
